# Self-Healing CI Fix Context

This document provides context about a CI fix generated by Nx Cloud's Self-Healing CI.

## Pull Request Context
**Title:** Migrate and install sb


## Tasks Being Fixed
- `ui:test`

## Error Summary
TASK ID: ui:test
[1m[33mThe '@nx/vite:test' executor is deprecated. Please use '@nx/vitest:test' instead. This executor will be removed in Nx 23.[39m[22m
[1m[33mUnable to load test config from config file /home/workflows/workspace/libs/ui/vite.config.ts[39m[22m
[1m[33mSome settings may not be applied as expected.[39m[22m
[1m[33mYou can manually set the config in the project, ui, configuration.[39m[22m


## Analysis & Reasoning
The PR introduced test files (Button.test.tsx, Badge.test.tsx, etc.) and a test target in libs/ui/project.json:15, but the implementation was incomplete. The test files import from 'vitest' and '@testing-library/*' packages that weren't installed, and the vite.config.ts lacked the necessary test configuration block.

**Why these specific changes:**

1. **Added vitest and testing dependencies to package.json** - The test files use vitest APIs (describe, it, expect) and @testing-library utilities (render, screen, userEvent). Without these packages, the tests cannot run. Version 4.0.18 was chosen for vitest to match the latest stable release and ensure compatibility with Vite 7.1.3.

2. **Added @nx/vitest:22.4.5** - This matches the existing Nx version (22.4.5) and is required as a peer dependency for the @nx/vite:test executor. The Nx documentation confirms this plugin is needed for vitest integration.

3. **Added jsdom:^28.0.0** - React components need a DOM environment for testing. jsdom provides this simulated browser environment so React Testing Library can properly render and interact with components.

4. **Added vitest configuration to vite.config.ts** - The @nx/vite:test executor loads test config from this file. The configuration includes:
   - `globals: true` - Enables global test APIs (describe, it, expect) without explicit imports
   - `environment: 'jsdom'` - Provides DOM environment required for React component testing
   - `setupFiles: ['src/test-setup.ts']` - Points to the existing test-setup.ts that imports '@testing-library/jest-dom/vitest' for extended matchers
   - `include` pattern - Standard vitest pattern for discovering test files
   - `coverage.reportsDirectory` - Matches the output path specified in project.json:17

5. **Added vitest type reference** - The `/// <reference types='vitest' />` directive provides TypeScript type definitions for the test configuration block, enabling IDE autocomplete and type checking.

These changes complete the test infrastructure that was partially implemented in the PR, allowing the ui:test task to successfully load its configuration and execute the test suite.

---

_Generated by Nx Cloud Self-Healing CI_